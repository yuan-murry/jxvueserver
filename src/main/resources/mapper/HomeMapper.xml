<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.gxzh.jxvueserver.mapper.HomeMapper">
    <select id="selectSydwpie" resultType="com.gxzh.jxvueserver.dto.SydwPie">
        select *
        from (select jgsy_system_code, count(*) jgcount
              from jgsy_common jc
              where jc.jgsy_states = '1'
                and jc.jgsy_type = '12'
                and jc.dep_code like #{depCode}
              group by ROLLUP (jc.jgsy_system_code)) pivot(sum(jgcount)
    for jgsy_system_code in('' AS zj,
                            '01' AS dw,
                            '02' AS rd,
                            '03' AS zf,
                            '04' AS zx,
                            '07' AS fy,
                            '08' AS jcy,
                            '06' AS qt,
                            '05' AS mzdp))
    </select>

    <select id="selectXzjgpie" resultType="com.gxzh.jxvueserver.dto.XzjgPie">
        select *
        from (select jgsy_system_code, count(*) jgcount
              from jgsy_common jc
              where jc.jgsy_states = '1'
                and jc.jgsy_type in ('04', '06', '10')
                and jc.dep_code like #{depCode}
              group by ROLLUP (jc.jgsy_system_code)) pivot(sum(jgcount)
    for jgsy_system_code in('' AS zj,
                            '01' AS dw,
                            '02' AS rd,
                            '03' AS zf,
                            '04' AS zx,
                            '07' AS fy,
                            '08' AS jcy,
                            '06' AS qt,
                            '05' AS mzdp))
    </select>

    <select id="selectBzqk" resultType="com.gxzh.jxvueserver.dto.Bzqk">
        select sum(dzq_bz) dzq_bz,
               sum(dzq_zz) dzq_zz,
               sum(sy_bz)  sy_bz,
               sum(sy_zz)  sy_zz,
               sum(xz_dfp) xz_dfp,
               sum(sy_dfp) sy_dfp
        from (select sum(dzq_bz+ga_bz+jcy_bz+fy_bz+sf_bz)                      dzq_bz,
                     sum(dzq_zz+ga_zz+jcy_zz+fy_zz+sf_zz)                      dzq_zz,
                     sum(qebk_bz + cebt_bz + jfzl_bz) sy_bz,
                     sum(qebk_zz + cebt_zz + jfzl_zz) sy_zz,
                     0 as                             xz_dfp,
                     0 as                             sy_dfp
              from v_bzzz
              where geocode like #{depCode}
              union all

              select 0 as     dzq_bz,
                     0 as     dzq_zz,
                     0 as     sy_bz,
                     0 as     sy_zz,
                     sum(case
                             when jgsy_system_code in ('xz_dfp','ga_dfp','jcy_dfp','fy_dfp','sf_dfp','jy_dfp','qj_dfp') then
                                 bz
                             else
                                 0
                         end) xz_dfp,
                     sum(case
                             when jgsy_system_code in
                                  ('qebk_dfp', 'jfzl_dfp', 'cebt_dfp') then
                                 bz
                             else
                                 0
                         end) sy_dfp
              from V_TONGJI_DFPBZ_tjb t
              where dep_code like #{depCode})

    </select>

    <select id="selectXzLdzs" resultType="com.gxzh.jxvueserver.dto.Ldzs">
        select sum(
                                vv.sbjzzbz + vv.sbjfzbz + vv.tjjzzbz + vv.tjjfzbz + vv.xcjzzbz +
                                vv.xcjfzbz + vv.xkjzzbz + vv.xkjfzbz + vv.gjzzbz + vv.gjfzbz +
                                vv.wdjbzs + vv.qtbzs
            )        ldbz,
               sum(
                                vv.sbjzzzz + vv.sbjfzzz + vv.tjjzzzz + vv.tjjfzzz + vv.xcjzzzz +
                                vv.xcjfzzz + vv.xkjzzzz + vv.xkjfzzz + vv.gjzzzz + vv.gjfzzz +
                                vv.wdjzzs + vv.qtzzs
                   ) ldzz

        from bmldzs vv
                 left join jgsy_common jc
                           on jc.jgsy_code = vv.jgsy_code
        where jc.jgsy_type in ('04', '06', '10')
          and jc.jgsy_states = '1'
          and jc.dep_code like #{depCode}

    </select>

    <select id="selectSyLdzs" resultType="com.gxzh.jxvueserver.dto.Ldzs">
        select sum(
                                vv.sbjzzbz + vv.sbjfzbz + vv.tjjzzbz + vv.tjjfzbz + vv.xcjzzbz +
                                vv.xcjfzbz + vv.xkjzzbz + vv.xkjfzbz + vv.gjzzbz + vv.gjfzbz +
                                vv.wdjbzs + vv.qtbzs
            )        ldbz,
               sum(
                                vv.sbjzzzz + vv.sbjfzzz + vv.tjjzzzz + vv.tjjfzzz + vv.xcjzzzz +
                                vv.xcjfzzz + vv.xkjzzzz + vv.xkjfzzz + vv.gjzzzz + vv.gjfzzz +
                                vv.wdjzzs + vv.qtzzs
                   ) ldzz

        from bmldzs vv
                 left join jgsy_common jc
                           on jc.jgsy_code = vv.jgsy_code
        where jc.jgsy_type = '12'
          and jc.jgsy_states = '1'
          and jc.dep_code like #{depCode}

    </select>

    <select id="testbase" resultType="string">
        select jgsy_name
        from jgsy_common
        where jgsy_code = '150000-01-10001'
    </select>
    <select id="getGeoSituation" resultType="com.gxzh.jxvueserver.dto.GeoSituation">
        select *
        from geo_situation
        where depcode = #{depCode}
    </select>

    <select id="selectXzjgLdzsChild" resultType="com.gxzh.jxvueserver.dto.XzjgLdzsChild">
        <choose>
        <when test="ldzstype=='bz'">
            select

            '省部级正职数' as ldzsname,
            sum(vv.sbjzzbz) as ldzscount
            from bmldzs vv
            left join jgsy_common jc
            on jc.jgsy_code = vv.jgsy_code
            where jc.jgsy_type in ('04', '06', '10')
            and jc.jgsy_states = '1'
            and jc.dep_code like #{depCode}
            union all
            select

            '省部级副职数' as ldzsname,
            sum(vv.sbjfzbz) as ldzscount
            from bmldzs vv
            left join jgsy_common jc
            on jc.jgsy_code = vv.jgsy_code
            where jc.jgsy_type in ('04', '06', '10')
            and jc.jgsy_states = '1'
            and jc.dep_code like #{depCode}
            union all
            select

            '厅局级正职数' as ldzsname,
            sum(vv.tjjzzbz) as ldzscount
            from bmldzs vv
            left join jgsy_common jc
            on jc.jgsy_code = vv.jgsy_code
            where jc.jgsy_type in ('04', '06', '10')
            and jc.jgsy_states = '1'
            and jc.dep_code like #{depCode}
            union all
            select

            '厅局级副职数' as ldzsname,
            sum(vv.tjjfzbz) as ldzscount
            from bmldzs vv
            left join jgsy_common jc
            on jc.jgsy_code = vv.jgsy_code
            where jc.jgsy_type in ('04', '06', '10')
            and jc.jgsy_states = '1'
            and jc.dep_code like #{depCode}
            union all
            select

            '县处级正职数' as ldzsname,
            sum(vv.xcjzzbz) as ldzscount
            from bmldzs vv
            left join jgsy_common jc
            on jc.jgsy_code = vv.jgsy_code
            where jc.jgsy_type in ('04', '06', '10')
            and jc.jgsy_states = '1'
            and jc.dep_code like #{depCode}
            union all
            select

            '县处级副职数' as ldzsname,
            sum(vv.xcjfzbz) as ldzscount
            from bmldzs vv
            left join jgsy_common jc
            on jc.jgsy_code = vv.jgsy_code
            where jc.jgsy_type in ('04', '06', '10')
            and jc.jgsy_states = '1'
            and jc.dep_code like #{depCode}
            union all
            select

            '乡科级正职数' as ldzsname,
            sum(vv.xkjzzbz) as ldzscount
            from bmldzs vv
            left join jgsy_common jc
            on jc.jgsy_code = vv.jgsy_code
            where jc.jgsy_type in ('04', '06', '10')
            and jc.jgsy_states = '1'
            and jc.dep_code like #{depCode}
            union all
            select

            '乡科级副职数' as ldzsname,
            sum(vv.xkjfzbz) as ldzscount
            from bmldzs vv
            left join jgsy_common jc
            on jc.jgsy_code = vv.jgsy_code
            where jc.jgsy_type in ('04', '06', '10')
            and jc.jgsy_states = '1'
            and jc.dep_code like #{depCode}
            union all
            select

            '股级正职数' as ldzsname,
            sum(vv.gjzzbz) as ldzscount
            from bmldzs vv
            left join jgsy_common jc
            on jc.jgsy_code = vv.jgsy_code
            where jc.jgsy_type in ('04', '06', '10')
            and jc.jgsy_states = '1'
            and jc.dep_code like #{depCode}
            union all
            select

            '股级副职数' as ldzsname,
            sum(vv.gjfzbz) as ldzscount
            from bmldzs vv
            left join jgsy_common jc
            on jc.jgsy_code = vv.jgsy_code
            where jc.jgsy_type in ('04', '06', '10')
            and jc.jgsy_states = '1'
            and jc.dep_code like #{depCode}
            union all
            select

            '未定级领导职数' as ldzsname,
            sum(vv.wdjbzs) as ldzscount
            from bmldzs vv
            left join jgsy_common jc
            on jc.jgsy_code = vv.jgsy_code
            where jc.jgsy_type in ('04', '06', '10')
            and jc.jgsy_states = '1'
            and jc.dep_code like #{depCode}
            union all
            select

            '其他领导职数' as ldzsname,
            sum(vv.qtbzs) as ldzscount
            from bmldzs vv
            left join jgsy_common jc
            on jc.jgsy_code = vv.jgsy_code
            where jc.jgsy_type in ('04', '06', '10')
            and jc.jgsy_states = '1'
            and jc.dep_code like #{depCode}
        </when>
<otherwise>
    select

    '省部级正职在职数' as ldzsname,
    sum(vv.sbjzzzz) as ldzscount
    from bmldzs vv
    left join jgsy_common jc
    on jc.jgsy_code = vv.jgsy_code
    where jc.jgsy_type in ('04', '06', '10')
    and jc.jgsy_states = '1'
    and jc.dep_code like #{depCode}
    union all
    select

    '省部级副职在职数' as ldzsname,
    sum(vv.sbjfzzz) as ldzscount
    from bmldzs vv
    left join jgsy_common jc
    on jc.jgsy_code = vv.jgsy_code
    where jc.jgsy_type in ('04', '06', '10')
    and jc.jgsy_states = '1'
    and jc.dep_code like #{depCode}
    union all
    select

    '厅局级正职在职数' as ldzsname,
    sum(vv.tjjzzzz) as ldzscount
    from bmldzs vv
    left join jgsy_common jc
    on jc.jgsy_code = vv.jgsy_code
    where jc.jgsy_type in ('04', '06', '10')
    and jc.jgsy_states = '1'
    and jc.dep_code like #{depCode}
    union all
    select

    '厅局级副职在职数' as ldzsname,
    sum(vv.tjjfzzz) as ldzscount
    from bmldzs vv
    left join jgsy_common jc
    on jc.jgsy_code = vv.jgsy_code
    where jc.jgsy_type in ('04', '06', '10')
    and jc.jgsy_states = '1'
    and jc.dep_code like #{depCode}
    union all
    select

    '县处级正职在职数' as ldzsname,
    sum(vv.xcjzzzz) as ldzscount
    from bmldzs vv
    left join jgsy_common jc
    on jc.jgsy_code = vv.jgsy_code
    where jc.jgsy_type in ('04', '06', '10')
    and jc.jgsy_states = '1'
    and jc.dep_code like #{depCode}
    union all
    select

    '县处级副职在职数' as ldzsname,
    sum(vv.xcjfzzz) as ldzscount
    from bmldzs vv
    left join jgsy_common jc
    on jc.jgsy_code = vv.jgsy_code
    where jc.jgsy_type in ('04', '06', '10')
    and jc.jgsy_states = '1'
    and jc.dep_code like #{depCode}
    union all
    select

    '乡科级正职在职数' as ldzsname,
    sum(vv.xkjzzzz) as ldzscount
    from bmldzs vv
    left join jgsy_common jc
    on jc.jgsy_code = vv.jgsy_code
    where jc.jgsy_type in ('04', '06', '10')
    and jc.jgsy_states = '1'
    and jc.dep_code like #{depCode}
    union all
    select

    '乡科级副职在职数' as ldzsname,
    sum(vv.xkjfzzz) as ldzscount
    from bmldzs vv
    left join jgsy_common jc
    on jc.jgsy_code = vv.jgsy_code
    where jc.jgsy_type in ('04', '06', '10')
    and jc.jgsy_states = '1'
    and jc.dep_code like #{depCode}
    union all
    select

    '股级正职在职数' as ldzsname,
    sum(vv.gjzzzz) as ldzscount
    from bmldzs vv
    left join jgsy_common jc
    on jc.jgsy_code = vv.jgsy_code
    where jc.jgsy_type in ('04', '06', '10')
    and jc.jgsy_states = '1'
    and jc.dep_code like #{depCode}
    union all
    select

    '股级副职在职数' as ldzsname,
    sum(vv.gjfzzz) as ldzscount
    from bmldzs vv
    left join jgsy_common jc
    on jc.jgsy_code = vv.jgsy_code
    where jc.jgsy_type in ('04', '06', '10')
    and jc.jgsy_states = '1'
    and jc.dep_code like #{depCode}
    union all
    select

    '未定级在职数' as ldzsname,
    sum(vv.wdjzzs) as ldzscount
    from bmldzs vv
    left join jgsy_common jc
    on jc.jgsy_code = vv.jgsy_code
    where jc.jgsy_type in ('04', '06', '10')
    and jc.jgsy_states = '1'
    and jc.dep_code like #{depCode}
    union all
    select

    '其他在职数' as ldzsname,
    sum(vv.qtzzs) as ldzscount
    from bmldzs vv
    left join jgsy_common jc
    on jc.jgsy_code = vv.jgsy_code
    where jc.jgsy_type in ('04', '06', '10')
    and jc.jgsy_states = '1'
    and jc.dep_code like #{depCode}

</otherwise>
        </choose>

    </select>

    <select id="selectSyjgLdzsChild" resultType="com.gxzh.jxvueserver.dto.SyjgLdzsChild">
        <choose>
            <when test="ldzstype=='bz'">
                select

                '省部级正职数' as ldzsname,
                sum(vv.sbjzzbz) as ldzscount
                from bmldzs vv
                left join jgsy_common jc
                on jc.jgsy_code = vv.jgsy_code
                where jc.jgsy_type = '12'
                and jc.jgsy_states = '1'
                and jc.dep_code like #{depCode}
                union all
                select

                '省部级副职数' as ldzsname,
                sum(vv.sbjfzbz) as ldzscount
                from bmldzs vv
                left join jgsy_common jc
                on jc.jgsy_code = vv.jgsy_code
                where jc.jgsy_type = '12'
                and jc.jgsy_states = '1'
                and jc.dep_code like #{depCode}
                union all
                select

                '厅局级正职数' as ldzsname,
                sum(vv.tjjzzbz) as ldzscount
                from bmldzs vv
                left join jgsy_common jc
                on jc.jgsy_code = vv.jgsy_code
                where jc.jgsy_type = '12'
                and jc.jgsy_states = '1'
                and jc.dep_code like #{depCode}
                union all
                select

                '厅局级副职数' as ldzsname,
                sum(vv.tjjfzbz) as ldzscount
                from bmldzs vv
                left join jgsy_common jc
                on jc.jgsy_code = vv.jgsy_code
                where jc.jgsy_type = '12'
                and jc.jgsy_states = '1'
                and jc.dep_code like #{depCode}
                union all
                select

                '县处级正职数' as ldzsname,
                sum(vv.xcjzzbz) as ldzscount
                from bmldzs vv
                left join jgsy_common jc
                on jc.jgsy_code = vv.jgsy_code
                where jc.jgsy_type = '12'
                and jc.jgsy_states = '1'
                and jc.dep_code like #{depCode}
                union all
                select

                '县处级副职数' as ldzsname,
                sum(vv.xcjfzbz) as ldzscount
                from bmldzs vv
                left join jgsy_common jc
                on jc.jgsy_code = vv.jgsy_code
                where jc.jgsy_type = '12'
                and jc.jgsy_states = '1'
                and jc.dep_code like #{depCode}
                union all
                select

                '乡科级正职数' as ldzsname,
                sum(vv.xkjzzbz) as ldzscount
                from bmldzs vv
                left join jgsy_common jc
                on jc.jgsy_code = vv.jgsy_code
                where jc.jgsy_type = '12'
                and jc.jgsy_states = '1'
                and jc.dep_code like #{depCode}
                union all
                select

                '乡科级副职数' as ldzsname,
                sum(vv.xkjfzbz) as ldzscount
                from bmldzs vv
                left join jgsy_common jc
                on jc.jgsy_code = vv.jgsy_code
                where jc.jgsy_type = '12'
                and jc.jgsy_states = '1'
                and jc.dep_code like #{depCode}
                union all
                select

                '股级正职数' as ldzsname,
                sum(vv.gjzzbz) as ldzscount
                from bmldzs vv
                left join jgsy_common jc
                on jc.jgsy_code = vv.jgsy_code
                where jc.jgsy_type = '12'
                and jc.jgsy_states = '1'
                and jc.dep_code like #{depCode}
                union all
                select

                '股级副职数' as ldzsname,
                sum(vv.gjfzbz) as ldzscount
                from bmldzs vv
                left join jgsy_common jc
                on jc.jgsy_code = vv.jgsy_code
                where jc.jgsy_type = '12'
                and jc.jgsy_states = '1'
                and jc.dep_code like #{depCode}
                union all
                select

                '未定级领导职数' as ldzsname,
                sum(vv.wdjbzs) as ldzscount
                from bmldzs vv
                left join jgsy_common jc
                on jc.jgsy_code = vv.jgsy_code
                where jc.jgsy_type = '12'
                and jc.jgsy_states = '1'
                and jc.dep_code like #{depCode}
                union all
                select

                '其他领导职数' as ldzsname,
                sum(vv.qtbzs) as ldzscount
                from bmldzs vv
                left join jgsy_common jc
                on jc.jgsy_code = vv.jgsy_code
                where jc.jgsy_type = '12'
                and jc.jgsy_states = '1'
                and jc.dep_code like #{depCode}
            </when>
            <otherwise>
                select

                '省部级正职在职数' as ldzsname,
                sum(vv.sbjzzzz) as ldzscount
                from bmldzs vv
                left join jgsy_common jc
                on jc.jgsy_code = vv.jgsy_code
                where jc.jgsy_type = '12'
                and jc.jgsy_states = '1'
                and jc.dep_code like #{depCode}
                union all
                select

                '省部级副职在职数' as ldzsname,
                sum(vv.sbjfzzz) as ldzscount
                from bmldzs vv
                left join jgsy_common jc
                on jc.jgsy_code = vv.jgsy_code
                where jc.jgsy_type = '12'
                and jc.jgsy_states = '1'
                and jc.dep_code like #{depCode}
                union all
                select

                '厅局级正职在职数' as ldzsname,
                sum(vv.tjjzzzz) as ldzscount
                from bmldzs vv
                left join jgsy_common jc
                on jc.jgsy_code = vv.jgsy_code
                where jc.jgsy_type = '12'
                and jc.jgsy_states = '1'
                and jc.dep_code like #{depCode}
                union all
                select

                '厅局级副职在职数' as ldzsname,
                sum(vv.tjjfzzz) as ldzscount
                from bmldzs vv
                left join jgsy_common jc
                on jc.jgsy_code = vv.jgsy_code
                where jc.jgsy_type = '12'
                and jc.jgsy_states = '1'
                and jc.dep_code like #{depCode}
                union all
                select

                '县处级正职在职数' as ldzsname,
                sum(vv.xcjzzzz) as ldzscount
                from bmldzs vv
                left join jgsy_common jc
                on jc.jgsy_code = vv.jgsy_code
                where jc.jgsy_type = '12'
                and jc.jgsy_states = '1'
                and jc.dep_code like #{depCode}
                union all
                select

                '县处级副职在职数' as ldzsname,
                sum(vv.xcjfzzz) as ldzscount
                from bmldzs vv
                left join jgsy_common jc
                on jc.jgsy_code = vv.jgsy_code
                where jc.jgsy_type = '12'
                and jc.jgsy_states = '1'
                and jc.dep_code like #{depCode}
                union all
                select

                '乡科级正职在职数' as ldzsname,
                sum(vv.xkjzzzz) as ldzscount
                from bmldzs vv
                left join jgsy_common jc
                on jc.jgsy_code = vv.jgsy_code
                where jc.jgsy_type = '12'
                and jc.jgsy_states = '1'
                and jc.dep_code like #{depCode}
                union all
                select

                '乡科级副职在职数' as ldzsname,
                sum(vv.xkjfzzz) as ldzscount
                from bmldzs vv
                left join jgsy_common jc
                on jc.jgsy_code = vv.jgsy_code
                where jc.jgsy_type = '12'
                and jc.jgsy_states = '1'
                and jc.dep_code like #{depCode}
                union all
                select

                '股级正职在职数' as ldzsname,
                sum(vv.gjzzzz) as ldzscount
                from bmldzs vv
                left join jgsy_common jc
                on jc.jgsy_code = vv.jgsy_code
                where jc.jgsy_type = '12'
                and jc.jgsy_states = '1'
                and jc.dep_code like #{depCode}
                union all
                select

                '股级副职在职数' as ldzsname,
                sum(vv.gjfzzz) as ldzscount
                from bmldzs vv
                left join jgsy_common jc
                on jc.jgsy_code = vv.jgsy_code
                where jc.jgsy_type = '12'
                and jc.jgsy_states = '1'
                and jc.dep_code like #{depCode}
                union all
                select

                '未定级在职数' as ldzsname,
                sum(vv.wdjzzs) as ldzscount
                from bmldzs vv
                left join jgsy_common jc
                on jc.jgsy_code = vv.jgsy_code
                where jc.jgsy_type = '12'
                and jc.jgsy_states = '1'
                and jc.dep_code like #{depCode}
                union all
                select

                '其他在职数' as ldzsname,
                sum(vv.qtzzs) as ldzscount
                from bmldzs vv
                left join jgsy_common jc
                on jc.jgsy_code = vv.jgsy_code
                where jc.jgsy_type = '12'
                and jc.jgsy_states = '1'
                and jc.dep_code like #{depCode}

            </otherwise>
        </choose>

    </select>
    <select id="selectXzjgPieChild" resultType="com.gxzh.jxvueserver.dto.XzjgPieChild">
        select jc.jgsy_name as jgname
        from jgsy_common jc
        where jc.jgsy_states = '1'
          and jc.jgsy_type in ('04', '06', '10')
          and jc.dep_code like #{depCode}
          and jgsy_system_code = #{depName}


    </select>

    <select id="selectSydwPieChild" resultType="com.gxzh.jxvueserver.dto.SydwPieChild">
        select jc.jgsy_name as jgname
        from jgsy_common jc
        where jc.jgsy_states = '1'
          and jc.jgsy_type = '12'
          and jc.dep_code like #{depCode}
          and jgsy_system_code = #{depName}


    </select>

    <select id="selectXzjgLdzsChildDetail" resultType="com.gxzh.jxvueserver.dto.XzjgLdzsChildDetail" parameterType="String">

                 select jc.jgsy_name as ldzsname,
                        ${doquery}   as ldzscount
                 from bmldzs vv
                          left join jgsy_common jc
                                    on jc.jgsy_code = vv.jgsy_code
                 where jc.jgsy_type in ('04', '06', '10')
                   and jc.jgsy_states = '1'
                   and jc.dep_code like #{depCode}
                   and ${doquery} !=0

    </select>


    <select id="selectSydwLdzsChildDetail" resultType="com.gxzh.jxvueserver.dto.SydwLdzsChildDetail" parameterType="String">

        select jc.jgsy_name as ldzsname,
               ${doquery}   as ldzscount
        from bmldzs vv
                 left join jgsy_common jc
                           on jc.jgsy_code = vv.jgsy_code
        where jc.jgsy_type = '12'
          and jc.jgsy_states = '1'
          and jc.dep_code like #{depCode}
          and ${doquery} !=0

    </select>
</mapper>